function [dv_dt] =GH_Intermediate (t, v, S, x_hat, T, K)
%---------------------------------------
[s,~] = size(S);
%---------------------------------------
gamma = zeros(s,1);
%---------------------------------------
for i = 1:s
    F_i = x_hat(i,:);
    gamma(i) = GH_Bezier_curve (t, T, F_i);
end
%---------------------------------------
x = gamma;
%---------------------------------------
Gamma_v = diag(v);
%---------------------------------------
g = GH_Denominator (x, K);
%---------------------------------------
Gamma_g = diag(g);
%---------------------------------------
psi = GH_Psi(x, v, K, S);
%---------------------------------------
Gamma_x = diag(x);
%---------------------------------------
Delta = - min(S,0);
%---------------------------------------
dv_dt = Gamma_v*Delta'*inv(Gamma_x)*S*v + Gamma_v*inv(Gamma_g)*psi ; 
end
